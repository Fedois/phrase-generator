<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>memoryGame</title>
</head>
<body>
    <div class="play" style="display: flex;">
        <button onclick="playGame()">play/shuffle</button> &nbsp;&nbsp;
        <p id="player1" style="color: red;"></p> &nbsp; | &nbsp;
        <p id="player2" style="color: blue;"></p>
    </div>
    <ul class="cards"></ul>

    <script type="text/javascript">
        let firstCard, pointPlayerA, pointPlayerB, playerTurn, disableClick;
        playGame()

        function playGame(){
            setDefaultData()
            displayPoint()
            setPlayerTurn()

            const memoryIds = Array.from({length: 26}, (_, i) => i + 1).flatMap(i => [i,i])
            memoryIds.sort(() => Math.random() > 0.5 ? 1 : -1);

            for (const id in memoryIds) {
                document.querySelector('.cards').innerHTML += `
                <li class="card" onClick="flipCard(this)" id="card-${memoryIds[id]}">
                    <div class="view back-view">
                        <img src="images/back_image_memory.png" alt="icon">
                    </div>
                    <div class="view front-view">
                        <img src="images/memory${memoryIds[id]}.jpg" alt="card-img">
                    </div>
                </li>
                `
            }
        }

        function flipCard(clickedCard){
            if(clickedCard.classList.contains('flip') || disableClick) return

            clickedCard.classList.add('flip')
            if(!firstCard) return firstCard = clickedCard

            disableClick = true
            if(firstCard.id === clickedCard.id){
                playerTurn ? pointPlayerA++ : pointPlayerB++
                displayPoint()
                firstCard = null
                disableClick = false
            } else {
                setTimeout(() => {
                    firstCard.classList.add("shake");
                    clickedCard.classList.add("shake");
                }, 400);
                setTimeout(() => {
                    firstCard.classList.remove('shake', 'flip')
                    clickedCard.classList.remove('shake', 'flip')
                    setPlayerTurn()
                    firstCard = null
                    disableClick = false
                }, 1000);
            }
        }

        function displayPoint(){
            document.getElementById('player1').innerHTML = 'player A: '+pointPlayerA
            document.getElementById('player2').innerHTML = 'player B: '+pointPlayerB
        }

        function setPlayerTurn(){
            playerTurn = !playerTurn
            document.body.style.background = playerTurn ? 'red' : 'blue'
        }

        function setDefaultData(){
            document.querySelector('.cards').innerHTML = ''
            firstCard = null
            pointPlayerA = pointPlayerB = 0
            disableClick = false
            playerTurn = Math.random() > 0.5 // true is playerA and false is playerB
        }

        //for debug
        function flipAll(){
            document.querySelectorAll('.card').forEach(element => {
                element.classList.add('flip')
            })
        }
    </script>
</body>
</html>