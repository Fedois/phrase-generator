<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>memoryGame</title>
</head>
<body>
    <div class="play" style="display: flex;">
        <button onclick="playGame()">play/shuffle</button> &nbsp;&nbsp;
        <p id="player1" style="color: red;"></p> &nbsp; | &nbsp;
        <p id="player2" style="color: blue;"></p>
    </div>
    <ul class="cards"></ul>

    <script type="text/javascript">
        let cardOne, cardTwo, pointPlayerA, pointPlayerB, playerTurn, disableClick;
        playGame()

        function playGame(){
            defaultData()
            displayPoint()
            setPlayerTurn()

            const arr = Array.from({length: 19}, (_, i) => i + 1).flatMap(i => [i,i])
            arr.sort(() => Math.random() > 0.5 ? 1 : -1);

            for (const index in arr) {
                document.querySelector('.cards').innerHTML += `
                <li class="card" onClick="flipCard(this)" id="card-${arr[index]}">
                    <div class="view front-view">
                        <img src="https://cdn.jsdelivr.net/gh/Sop20Games/memory-card@main/images/que_icon.svg" alt="icon">
                    </div>
                    <div class="view back-view">
                        <img src="images/memory${arr[index]}.jpg" alt="card-img">
                    </div>
                </li>
                `
            }
        }

        function flipCard(clickedCard){
            if(clickedCard.classList.contains('flip') || disableClick) return

            clickedCard.classList.add('flip')
            if(!cardOne) return cardOne = clickedCard

            cardTwo = clickedCard
            disableClick = true

            if(cardOne.id === cardTwo.id){
                if(playerTurn) pointPlayerA++
                else pointPlayerB++
                displayPoint()
                cardOne = cardTwo = null
                disableClick = false
            } else {
                setTimeout(() => {
                    cardOne.classList.add("shake");
                    cardTwo.classList.add("shake");
                }, 400);
                setTimeout(() => {
                    cardOne.classList.remove('shake', 'flip')
                    cardTwo.classList.remove('shake', 'flip')
                    setPlayerTurn()
                    cardOne = cardTwo = null
                    disableClick = false
                }, 1000);
            }
        }

        function displayPoint(){
            document.getElementById('player1').innerHTML = 'player A: '+pointPlayerA
            document.getElementById('player2').innerHTML = 'player B: '+pointPlayerB
        }

        function setPlayerTurn(){
            playerTurn = !playerTurn
            document.body.className = playerTurn ? 'playerA' : 'playerB'
        }

        function defaultData(){
            document.querySelector('.cards').innerHTML = ''
            cardOne = null
            cardTwo = null
            pointPlayerA = 0
            pointPlayerB = 0
            disableClick = false
            playerTurn = Math.random() > 0.5 // true is playerA and false is playerB
        }

        //for debug
        function FlipAll(){
            document.querySelectorAll('.card').forEach(element => {
                element.classList.add('flip')
            })
        }
    </script>
</body>
</html>